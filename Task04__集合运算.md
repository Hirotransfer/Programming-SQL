# Task 04：集合运算

**本章学习重点：**
本章将会学习使用 2 张以上的表的SQL语句。通过以行方向（竖）为单位的集合运算符和以列方向（横）为单位的联结，就可以将分散在多张表中的数据组合成为期望的结果。

## 4.1 表的加减法

**本节学习重点：**
（1）集合运算就是对满足同一规则的记录进行的加减等四则运算。
（2）使用UNION（并集）、INTERSECT（交集）、EXCEPT（差集）等集合运算符来进行集合运算。
（3）集合运算符可以去除重复行。
（4）如果希望集合运算符保留重复行，就需要使用ALL选项。

- 什么是集合运算
一般来说，表、视图和查询的执行结果都是记录的集合。所谓集合运算，就是对满足同一规则的记录进行的加减等四则运算。通过集合运算，可以得到两张表中记录的集合或者公共记录的集合，又或者其中某张表中的记录的集合。像这样用来进行集合运算的运算符称为集合运算符。

- 表的加法——UNION

> Note：集合运算符会除去重复的记录。

- 集合运算的注意事项

（1）作为运算对象的记录的列数必须相同

（2）作为运算对象的记录中列的类型必须一致

（3）可以使用任何SELECT语句，但ORDER BY子句只能在最后使用一次

- 包含重复行的集合运算——ALL选项

> Note：在集合运算符中使用ALL选项，可以保留重复行。

- 选取表中公共部分——INTERSECT

与使用AND 可以选取出一张表中满足多个条件的公共部分不同，INTERSECT 应用于两张表，选取出它们当中的公共记录。

- 记录的减法——EXCEPT

## 4.2 联结（以列为单位进行联结）

**本节学习重点：**
（1）联结（JOIN）就是将其他表中的列添加过来，进行“添加列”的集合运算。UNION是以行（纵向）为单位进行操作，而联结则是以列（横向）为单位进行的。
（2）联结大体上分为内联结和外联结两种。首先请大家牢牢掌握这两种联结的使用方法。
（3）请大家一定要使用标准SQL的语法格式来写联结运算，对于那些过时的或者特定SQL 中的写法，了解一下即可，不建议使用。

- 什么是联结？

- 内联结——INNER JOIN

（1）内联结要点1 ——FROM子句

（2）内联结要点2 —— ON子句

（3）内联结要点3 ——SELECT子句

> Note：使用联结时SELECT子句中的列需要按照“<表的别名>.<列名>”的格式进行书写。

（4）内联结和WHERE子句结合使用

- 外联结——OUTER JOIN

（1）外联结要点1 ——选取出单张表中全部的信息

（2）外联结要点2 ——每张表都是主表吗？

> Note：外联结中使用LEFT、RIGHT来指定主表。使用二者所得到的结果完全相同。

- 3张以上的表的联结

- 交叉联结——CROSS JOIN

- 联结的特定语法和过时语法

**学习小结：**
SQL中比较常见的4个集合运算符。
- UNION（并集）
- EXCEPT（差集）
- INTERSECT（交集）
- CROSS JOIN（笛卡儿积）

## 4.3 学习理解

1. 请说出下述SELECT 语句的结果。

```sql
-- 使用本章中的Product表
SELECT *
FROM Product
UNION
SELECT *
FROM Product
INTERSECT
SELECT *
FROM Product
ORDER BY product_id;
```





